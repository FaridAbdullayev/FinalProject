<div class="content-wrapper">
    <h3 class="page-heading mb-4">Dashboard</h3>
    <div class="row">
        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 mb-4">
            <div class="card card-statistics">
                <div class="card-body">
                    <div class="clearfix">
                        <div class="float-left">
                            <h4 class="text-danger">
                                <i class="fa fa-bar-chart-o highlight-icon" aria-hidden="true"></i>
                            </h4>
                        </div>
                        <div class="float-right">
                            <p class="card-text text-dark">Visitors</p>
                            <h4 class="bold-text">65,650</h4>
                        </div>
                    </div>
                    <p class="text-muted">
                        <i class="fa fa-exclamation-circle mr-1" aria-hidden="true"></i> 65% lower growth
                    </p>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 mb-4">
            <div class="card card-statistics">
                <div class="card-body">
                    <div class="clearfix">
                        <div class="float-left">
                            <h4 class="text-warning">
                                <i class="fa fa-shopping-cart highlight-icon" aria-hidden="true"></i>
                            </h4>
                        </div>
                        <div class="float-right">
                            <p class="card-text text-dark">Orders</p>
                            <h4 class="bold-text">656</h4>
                        </div>
                    </div>
                    <p class="text-muted">
                        <i class="fa fa-bookmark-o mr-1" aria-hidden="true"></i> Product-wise sales
                    </p>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 mb-4">
            <div class="card card-statistics">
                <div class="card-body">
                    <div class="clearfix">
                        <div class="float-left">
                            <h4 class="text-success">
                                <i class="fa fa-dollar highlight-icon" aria-hidden="true"></i>
                            </h4>
                        </div>
                        <div class="float-right">
                            <p class="card-text text-dark">Revenue</p>
                            <h4 class="bold-text">$65656</h4>
                        </div>
                    </div>
                    <p class="text-muted">
                        <i class="fa fa-calendar mr-1" aria-hidden="true"></i> Weekly Sales
                    </p>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 mb-4">
            <div class="card card-statistics">
                <div class="card-body">
                    <div class="clearfix">
                        <div class="float-left">
                            <h4 class="text-primary">
                                <i class="fa fa-twitter highlight-icon" aria-hidden="true"></i>
                            </h4>
                        </div>
                        <div class="float-right">
                            <p class="card-text text-dark">Followers</p>
                            <h4 class="bold-text">+62,500</h4>
                        </div>
                    </div>
                    <p class="text-muted">
                        <i class="fa fa-repeat mr-1" aria-hidden="true"></i> Just Updated
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
      @*   <div class="col-lg-6 col-12 mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-4">Bar chart</h5>
                    <canvas id="barChart" style="height:230px"></canvas>
                </div>
            </div>
        </div> *@


         <div class="col-md-8 mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-4">Monthly Income Line Chart</h5>
                    <canvas id="incomeLineChart" style="height:400px"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Branches</h5>
                    <div class="custom-legend-container w-75 mx-auto">
                        <canvas id="sales-chart"></canvas>
                    </div>
                    <div id="sales-chart-legend" class="legend-right"></div>
                </div>
            </div>
        </div>

        @*      <div class="col-md-4 mb-4">
        <div class="card">
        <div class="card-body">
        <h5 class="card-title">Branch Incomes</h5>
        <div class="custom-legend-container w-75 mx-auto">
        <canvas id="branch-income-chart"></canvas>
        </div>
        <div id="branch-income-legend" class="legend-right"></div>
        </div>
        </div>
        </div>
        *@








        <div class="col-md-3 mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Sales region</h5>
                    <div class="table-responsive table-sales">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th colspan="2">
                                        Country
                                    </th>
                                    <th class="text-right">
                                        Sales
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <div class="flag">
                                            <i class="flag-icon flag-icon-us"></i>
                                        </div>
                                    </td>
                                    <td>USA</td>
                                    <td class="text-right">
                                        2.920
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="flag">
                                            <i class="flag-icon flag-icon-in"></i>
                                        </div>
                                    </td>
                                    <td>India</td>
                                    <td class="text-right">
                                        8.265
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="flag">
                                            <i class="flag-icon flag-icon-id"></i>
                                        </div>
                                    </td>
                                    <td>Indonesia</td>
                                    <td class="text-right">
                                        787
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="flag">
                                            <i class="flag-icon flag-icon-gb"></i>
                                        </div>
                                    </td>
                                    <td>United Kingdom</td>
                                    <td class="text-right">
                                        690
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="flag">
                                            <i class="flag-icon flag-icon-ro"></i>
                                        </div>
                                    </td>
                                    <td>Romania</td>
                                    <td class="text-right">
                                        600
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="flag">
                                            <i class="flag-icon flag-icon-br"></i>
                                        </div>
                                    </td>
                                    <td>Brasil</td>
                                    <td class="text-right">
                                        550
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-deck">
        <div class="card col-lg-12 px-0 mb-4">
            <div class="card-body">
                <h5 class="card-title">Last Billings</h5>
                <div class="table-responsive">
                    <table class="table center-aligned-table">
                        <thead>
                            <tr class="text-primary">
                                <th>Order No</th>
                                <th>Product Name</th>
                                <th>Purchased On</th>
                                <th>Shipping Status</th>
                                <th>Payment Method</th>
                                <th>Payment Status</th>
                                <th></th>
                                <th></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="">
                                <td>034</td>
                                <td>Iphone 7</td>
                                <td>12 May 2017</td>
                                <td>Dispatched</td>
                                <td>Credit card</td>
                                <td><label class="badge badge-success">Approved</label></td>
                                <td><a href="#" class="btn btn-outline-success btn-sm">View Order</a></td>
                                <td><a href="#" class="btn btn-outline-warning btn-sm">Cancel</a></td>
                            </tr>
                            <tr class="">
                                <td>035</td>
                                <td>Galaxy S8</td>
                                <td>15 May 2017</td>
                                <td>Dispatched</td>
                                <td>Internet banking</td>
                                <td><label class="badge badge-warning">Pending</label></td>
                                <td><a href="#" class="btn btn-outline-success btn-sm">View Order</a></td>
                                <td><a href="#" class="btn btn-outline-warning btn-sm">Cancel</a></td>
                            </tr>
                            <tr class="">
                                <td>036</td>
                                <td>Amazon Echo</td>
                                <td>17 May 2017</td>
                                <td>Dispatched</td>
                                <td>Credit card</td>
                                <td><label class="badge badge-success">Approved</label></td>
                                <td><a href="#" class="btn btn-outline-success btn-sm">View Order</a></td>
                                <td><a href="#" class="btn btn-outline-warning btn-sm">Cancel</a></td>
                            </tr>
                            <tr class="">
                                <td>037</td>
                                <td>Google Pixel</td>
                                <td>17 May 2017</td>
                                <td>Dispatched</td>
                                <td>Cash on delivery</td>
                                <td><label class="badge badge-danger">Rejected</label></td>
                                <td><a href="#" class="btn btn-outline-success btn-sm">View Order</a></td>
                                <td><a href="#" class="btn btn-outline-warning btn-sm">Cancel</a></td>
                            </tr>
                            <tr class="">
                                <td>038</td>
                                <td>Mac Mini</td>
                                <td>19 May 2017</td>
                                <td>Dispatched</td>
                                <td>Debit card</td>
                                <td><label class="badge badge-success">Approved</label></td>
                                <td><a href="#" class="btn btn-outline-success btn-sm">View Order</a></td>
                                <td><a href="#" class="btn btn-outline-warning btn-sm">Cancel</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>


    document.addEventListener('DOMContentLoaded', function () {

        const fetchAndRenderChart = async () => {
            try {
                // API'den veri çek
                const response = await fetch(`/api/branches/incomes`);

                // console.log(response);

                // Veriyi konsola yazdırarak kontrol edin

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();

                // API'den gelen verileri işleyin
                const branchNames = data.map(branch => branch.branchName);
                const branchIncomes = data.map(branch => branch.income);

                // Grafiği oluştur
                const salesChartData = {
                    datasets: [{
                        data: branchIncomes,
                        backgroundColor: [
                            '#745af2',
                            '#5cd069',
                            '#fecb01',
                            '#4bc0c0',
                            '#ff6384',
                            '#36a2eb'
                        ],
                        borderWidth: 1
                    }],
                    labels: branchNames
                };
                const salesChartOptions = {
                    responsive: true,
                    cutoutPercentage: 70,
                    plugins: {
                        legend: {
                            display: true // Varsayılan efsaneği devre dışı bırak
                        },
                        tooltip: {
                            callbacks: {
                                label: function (tooltipItem) {
                                    return `${tooltipItem.label}: ${tooltipItem.raw.toFixed(2)} AZN`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                };

                const salesChartCanvas = document.querySelector("#sales-chart").getContext("2d");
                const salesChart = new Chart(salesChartCanvas, {
                    type: 'doughnut',
                    data: salesChartData,
                    options: salesChartOptions
                });

                // Grafiğin efsanesini HTML'e ekleyin
                document.querySelector("#sales-chart-legend").innerHTML = salesChart.generateLegend();

            } catch (error) {
                console.error('Error fetching branch incomes:', error);
            }
        };

        fetchAndRenderChart();
    });



</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const fetchAndRenderChart = async () => {
            try {
                // API'den veri çek
                const response = await fetch('/api/current-year-monthly-income');

                console.log(response)
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();

                console.log(data)
                // Veriyi işleyin
                const labels = Object.keys(data); // Ay isimleri
                const incomes = Object.values(data); // Gelirler

                // Grafiği oluştur
                const incomeChartData = {
                    labels: labels,
                    datasets: [{
                        label: 'Monthly Income',
                        data: incomes,
                        borderColor: '#36a2eb',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderWidth: 2,
                        fill: true
                    }]
                };

                const incomeChartOptions = {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true
                        },
                        tooltip: {
                            callbacks: {
                                label: function (tooltipItem) {
                                    return `Income: ${tooltipItem.raw.toFixed(2)} Azn`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                };

                const incomeChartCanvas = document.querySelector("#incomeLineChart").getContext("2d");
                new Chart(incomeChartCanvas, {
                    type: 'line',
                    data: incomeChartData,
                    options: incomeChartOptions
                });

            } catch (error) {
                console.error('Error fetching monthly income data:', error);
            }
        };

        fetchAndRenderChart();
    });

</script>












@*     <script src="../../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../../node_modules/popper.js/dist/umd/popper.min.js"></script>
    <script src="../../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="../../node_modules/perfect-scrollbar/dist/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="../../node_modules/chart.js/dist/Chart.min.js"></script>
    <script src="../../js/chart.js"></script>
    <script src="../../js/off-canvas.js"></script>
    <script src="../../js/hoverable-collapse.js"></script>
    <script src="../../js/misc.js"></script>
 *@